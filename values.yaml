# Default values for prometheus.
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

namespace: emso-monitoring
# nodeName: cluster-sn-ng-ingres-bazxvbzp64mx-node-0
image:
  repository: prom/prometheus
  pullPolicy: IfNotPresent
  tag: v2.51.1

reloaderImage:
  repository: ghcr.io/prometheus-operator/prometheus-config-reloader
  pullPolicy: IfNotPresent
  tag: v0.72.0

service:
  type: NodePort
  port: 9090
  nodePort: 30900

resources: {}
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

podAnnotations:
  sidecar.istio.io/inject: "false"

rbac:
  create: true

configMap:
  alertingRules:
    groups:
      - name: Rules
        rules:
          - alert: "(POD) Cáº£nh bÃ¡o RAM"
            expr: 'sum by (pod, namespace) (sum by (container, pod, namespace) (container_memory_usage_bytes{container!~"elasticsearch", namespace=~".+"}) / sum by (container, pod, namespace) (kube_pod_container_resource_limits{namespace=~".+", resource="memory"}) * 100 > 50 or sum by (container, pod, namespace) (container_memory_usage_bytes{container="elasticsearch", namespace=~".+"}) / sum by (container, pod, namespace) (kube_pod_container_resource_limits{namespace=~".+", resource="memory"}) * 100 > 80 or sum by (pod, namespace) ( rate(container_cpu_usage_seconds_total{namespace=~".+"}[1m])) * 100000 / (sum(container_spec_cpu_quota{namespace=~".+"}) by (pod, namespace)) > 0.5)'
            labels:
              severity: Kháº©n cáº¥p
              app_type: Application
              category: kubernetes
              instance: "{{ $labels.pod }}"
            annotations:
              summary: "TÃ i nguyÃªn tÄƒng"
              description: "cáº£nh bÃ¡o"

          - alert: Node KhÃ´ng Sáºµn SÃ ng
            expr: kube_node_status_condition{condition="Ready",status="true"} == 0
            for: 10m
            labels:
              severity: critical
            annotations:
              summary: "Node Kubernetes khÃ´ng sáºµn sÃ ng (mÃ¡y chá»§: {{ $labels.node }})"
              description: >
                Node {{ $labels.node }} Ä‘Ã£ khÃ´ng á»Ÿ tráº¡ng thÃ¡i sáºµn sÃ ng trong Ã­t nháº¥t 10 phÃºt.
                CÃ³ thá»ƒ node Ä‘Ã£ bá»‹ lá»—i, máº¥t káº¿t ná»‘i, hoáº·c Ä‘ang bá»‹ quÃ¡ táº£i.

                ğŸ” GiÃ¡ trá»‹: {{ $value }}
                ğŸ·ï¸ NhÃ£n: {{ $labels }}
                ğŸ“… Thá»i gian: {{ $value | humanizeTimestamp }}

          - alert: Node bá»‹ DiskPressure
            expr: kube_node_status_condition{condition="DiskPressure",status="true"} == 1
            for: 2m
            labels:
              severity: critical
            annotations:
              summary: "âš ï¸ Node Kubernetes Ä‘ang Ä‘áº§y Ä‘Ä©a ({{ $labels.instance }})"
              description: >
                Node {{ $labels.node }} Ä‘ang á»Ÿ tráº¡ng thÃ¡i *DiskPressure*, tá»©c lÃ  há»‡ thá»‘ng phÃ¡t hiá»‡n á»• Ä‘Ä©a gáº§n Ä‘áº§y hoáº·c khÃ´ng cÃ²n Ä‘á»§ dung lÆ°á»£ng Ä‘á»ƒ hoáº¡t Ä‘á»™ng á»•n Ä‘á»‹nh.

                â±ï¸ TÃ¬nh tráº¡ng kÃ©o dÃ i Ã­t nháº¥t 2 phÃºt.

                ğŸ“Š GiÃ¡ trá»‹: {{ $value }}
                ğŸ·ï¸ NhÃ£n: {{ $labels }}
                ğŸ“… Thá»i gian: {{ $value | humanizeTimestamp }}

          - alert: Container bá»‹ OOMKilled
            expr: (kube_pod_container_status_restarts_total - kube_pod_container_status_restarts_total offset 10m >= 1)
              and ignoring (reason)
              min_over_time(kube_pod_container_status_last_terminated_reason{reason="OOMKilled"}[10m]) == 1
            for: 0m
            labels:
              severity: warning
            annotations:
              summary: "âš ï¸ Container bá»‹ thiáº¿u bá»™ nhá»› (OOMKilled)"
              description: >
                Container `{{ $labels.container }}` trong pod `{{ $labels.namespace }}/{{ $labels.pod }}` Ä‘Ã£ bá»‹ há»‡ thá»‘ng dá»«ng do vÆ°á»£t quÃ¡ giá»›i háº¡n bá»™ nhá»› (OOMKilled) Ã­t nháº¥t 1 láº§n trong 10 phÃºt gáº§n Ä‘Ã¢y.

                ğŸ” Sá»‘ láº§n restart tÄƒng lÃªn trong khoáº£ng thá»i gian Ä‘Ã³.

                ğŸ“Š GiÃ¡ trá»‹: {{ $value }}
                ğŸ·ï¸ NhÃ£n: {{ $labels }}
                ğŸ“… Thá»i gian: {{ $value | humanizeTimestamp }}


persistence:
  enabled: false
  # storageClass: "-"
  # size: 8Gi