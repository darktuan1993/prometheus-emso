# Default values for prometheus.
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

namespace: emso-monitoring
# nodeName: cluster-sn-ng-ingres-bazxvbzp64mx-node-0
image:
  repository: prom/prometheus
  pullPolicy: IfNotPresent
  tag: v2.51.1

reloaderImage:
  repository: ghcr.io/prometheus-operator/prometheus-config-reloader
  pullPolicy: IfNotPresent
  tag: v0.72.0

service:
  type: NodePort
  port: 9090
  nodePort: 30900

resources: {}
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

podAnnotations:
  sidecar.istio.io/inject: "false"

rbac:
  create: true

configMap:
  alertingRules:
    groups:
      - name: Rules
        rules:
          - alert: "(POD) C·∫£nh b√°o RAM"
            expr: 'sum by (job,container,namespace,pod) ((sum by (container, pod, namespace) (container_memory_usage_bytes{container!~"elasticsearch", namespace=~".+"})/sum by (container, pod, namespace) (kube_pod_container_resource_limits{resource="memory", namespace=~".+"}))* on (namespace, pod) group_left(job) kube_pod_info) * 100 > 90'
            labels:
              severity: Kh·∫©n c·∫•p
              app_type: Application
              category: kubernetes
              instance: "{{ $labels.pod }}"
            annotations:
              summary: "T√†i nguy√™n tƒÉng"
              description: "c·∫£nh b√°o"

          - alert: Node Kh√¥ng S·∫µn S√†ng
            expr: kube_node_status_condition{condition="Ready",status="true"} == 0
            for: 10m
            labels:
              severity: critical
            annotations:
              summary: "Node Kubernetes kh√¥ng s·∫µn s√†ng (m√°y ch·ªß: {{ $labels.node }})"
              description: >
                Node {{ $labels.node }} ƒë√£ kh√¥ng ·ªü tr·∫°ng th√°i s·∫µn s√†ng trong √≠t nh·∫•t 10 ph√∫t.
                C√≥ th·ªÉ node ƒë√£ b·ªã l·ªói, m·∫•t k·∫øt n·ªëi, ho·∫∑c ƒëang b·ªã qu√° t·∫£i.

                üîé Gi√° tr·ªã: {{ $value }}
                üè∑Ô∏è Nh√£n: {{ $labels }}
                üìÖ Th·ªùi gian: {{ $value | humanizeTimestamp }}

          - alert: Node b·ªã DiskPressure
            expr: kube_node_status_condition{condition="DiskPressure",status="true"} == 1
            for: 2m
            labels:
              severity: critical
            annotations:
              summary: "‚ö†Ô∏è Node Kubernetes ƒëang ƒë·∫ßy ƒëƒ©a ({{ $labels.instance }})"
              description: >
                Node {{ $labels.node }} ƒëang ·ªü tr·∫°ng th√°i *DiskPressure*, t·ª©c l√† h·ªá th·ªëng ph√°t hi·ªán ·ªï ƒëƒ©a g·∫ßn ƒë·∫ßy ho·∫∑c kh√¥ng c√≤n ƒë·ªß dung l∆∞·ª£ng ƒë·ªÉ ho·∫°t ƒë·ªông ·ªïn ƒë·ªãnh.

                ‚è±Ô∏è T√¨nh tr·∫°ng k√©o d√†i √≠t nh·∫•t 2 ph√∫t.

                üìä Gi√° tr·ªã: {{ $value }}
                üè∑Ô∏è Nh√£n: {{ $labels }}
                üìÖ Th·ªùi gian: {{ $value | humanizeTimestamp }}

          - alert: Container b·ªã OOMKilled
            expr: (kube_pod_container_status_restarts_total - kube_pod_container_status_restarts_total offset 10m >= 1)
              and ignoring (reason)
              min_over_time(kube_pod_container_status_last_terminated_reason{reason="OOMKilled"}[10m]) == 1
            for: 0m
            labels:
              severity: warning
            annotations:
              summary: "‚ö†Ô∏è Container b·ªã thi·∫øu b·ªô nh·ªõ (OOMKilled)"
              description: >
                Container `{{ $labels.container }}` trong pod `{{ $labels.namespace }}/{{ $labels.pod }}` ƒë√£ b·ªã h·ªá th·ªëng d·ª´ng do v∆∞·ª£t qu√° gi·ªõi h·∫°n b·ªô nh·ªõ (OOMKilled) √≠t nh·∫•t 1 l·∫ßn trong 10 ph√∫t g·∫ßn ƒë√¢y.

                üîÅ S·ªë l·∫ßn restart tƒÉng l√™n trong kho·∫£ng th·ªùi gian ƒë√≥.

                üìä Gi√° tr·ªã: {{ $value }}
                üè∑Ô∏è Nh√£n: {{ $labels }}
                üìÖ Th·ªùi gian: {{ $value | humanizeTimestamp }}

          - alert: PVC ƒêang ch·ªù ƒë∆∞·ª£c c·∫•p ph√°t
            expr: kube_persistentvolumeclaim_status_phase{phase="Pending"} == 1
            for: 2m
            labels:
              severity: warning
            annotations:
              summary: "‚ö†Ô∏è PVC ƒëang ch·ªù ƒë∆∞·ª£c c·∫•p ph√°t (Pending)"
              description: >
                PersistentVolumeClaim `{{ $labels.namespace }}/{{ $labels.persistentvolumeclaim }}` ƒë√£ ·ªü tr·∫°ng th√°i *Pending* trong h∆°n 2 ph√∫t.

                üì¶ ƒêi·ªÅu n√†y c√≥ th·ªÉ khi·∫øn Pod kh√¥ng th·ªÉ kh·ªüi ƒë·ªông do thi·∫øu storage.

                üìä Gi√° tr·ªã: {{ $value }}
                üè∑Ô∏è Nh√£n: {{ $labels }}

          - alert: Volume G·∫ßn ƒë·∫ßy dung l∆∞·ª£ng
            expr: kubelet_volume_stats_available_bytes / kubelet_volume_stats_capacity_bytes * 100 < 10
            for: 2m
            labels:
              severity: warning
            annotations:
              summary: "‚ö†Ô∏è Volume g·∫ßn ƒë·∫ßy dung l∆∞·ª£ng (c√≤n d∆∞·ªõi 10%)"
              description: >
                M·ªôt volume ƒëang g·∫ßn ƒë·∫ßy ‚Äì ch·ªâ c√≤n d∆∞·ªõi 10% dung l∆∞·ª£ng kh·∫£ d·ª•ng.

                ƒêi·ªÅu n√†y c√≥ th·ªÉ g√¢y l·ªói ghi d·ªØ li·ªáu, crash ·ª©ng d·ª•ng ho·∫∑c d·ª´ng Pod n·∫øu v∆∞·ª£t qu√° gi·ªõi h·∫°n.

                üìä Gi√° tr·ªã: {{ $value }}%
                üè∑Ô∏è Nh√£n: {{ $labels }}

          - alert: StatefulSet kh√¥ng ƒë·ªß Pod
            expr: kube_statefulset_replicas - kube_statefulset_status_replicas_ready > 0
            for: 1m
            labels:
              severity: critical
            annotations:
              summary: "‚ùó StatefulSet kh√¥ng ƒë·ªß Pod ({{ $labels.namespace }}/{{ $labels.statefulset }})"
              description: >
                StatefulSet `{{ $labels.namespace }}/{{ $labels.statefulset }}` ƒëang c√≥ s·ªë l∆∞·ª£ng Pod s·∫µn s√†ng **√≠t h∆°n** so v·ªõi k·ª≥ v·ªçng.

                üì¶ S·ªë Pod c·∫ßn: `kube_statefulset_replicas`
                ‚úÖ S·ªë Pod s·∫µn s√†ng: `kube_statefulset_status_replicas_ready`

                C√≥ th·ªÉ do l·ªói container, node thi·∫øu t√†i nguy√™n, ho·∫∑c PVC g·∫∑p s·ª± c·ªë.

                üî¢ VALUE: {{ $value }}
                üè∑Ô∏è LABELS: {{ $labels }}

          - alert: HPA kh√¥ng th·ªÉ scale th√™m
            expr: (kube_horizontalpodautoscaler_spec_max_replicas - kube_horizontalpodautoscaler_status_desired_replicas)
                  * on (horizontalpodautoscaler,namespace)
                  (kube_horizontalpodautoscaler_status_condition{condition="ScalingLimited", status="true"} == 1) == 0
            for: 2m
            labels:
              severity: warning
            annotations:
              summary: "‚ö†Ô∏è HPA kh√¥ng th·ªÉ scale th√™m ({{ $labels.namespace }}/{{ $labels.horizontalpodautoscaler }})"
              description: >
                HorizontalPodAutoscaler `{{ $labels.namespace }}/{{ $labels.horizontalpodautoscaler }}` ƒëang ·ªü tr·∫°ng th√°i *ScalingLimited*, t·ª©c l√† kh√¥ng th·ªÉ m·ªü r·ªông th√™m s·ªë Pod d√π c√≥ nhu c·∫ßu.

                C√≥ th·ªÉ do ƒë√£ ƒë·∫°t ƒë·∫øn gi·ªõi h·∫°n `maxReplicas`, t√†i nguy√™n cluster kh√¥ng ƒë·ªß, ho·∫∑c Pod kh√¥ng kh·ªüi ƒë·ªông ƒë∆∞·ª£c.

                üìä Gi√° tr·ªã: {{ $value }}
                üè∑Ô∏è Nh√£n: {{ $labels }}

          - alert: HPA ƒë√£ ƒë·∫°t ƒë·∫øn gi·ªõi h·∫°n t·ªëi ƒëa s·ªë Pod
            expr: (kube_horizontalpodautoscaler_status_desired_replicas >= kube_horizontalpodautoscaler_spec_max_replicas)
                  and (kube_horizontalpodautoscaler_spec_max_replicas > 1)
                  and (kube_horizontalpodautoscaler_spec_min_replicas != kube_horizontalpodautoscaler_spec_max_replicas)
            for: 2m
            labels:
              severity: info
            annotations:
              summary: "‚ÑπÔ∏è HPA ƒë√£ ƒë·∫°t ƒë·∫øn gi·ªõi h·∫°n t·ªëi ƒëa s·ªë Pod"
              description: >
                HPA `{{ $labels.namespace }}/{{ $labels.horizontalpodautoscaler }}` ƒë√£ scale ƒë·∫øn s·ªë Pod t·ªëi ƒëa ƒë∆∞·ª£c c·∫•u h√¨nh (`maxReplicas`).

                üëâ ƒêi·ªÅu n√†y c√≥ th·ªÉ cho th·∫•y workload ƒëang c·∫ßn nhi·ªÅu t√†i nguy√™n h∆°n, ho·∫∑c b·∫°n n√™n c√¢n nh·∫Øc n√¢ng `maxReplicas`.

                üìä Gi√° tr·ªã: {{ $value }}
                üè∑Ô∏è Nh√£n: {{ $labels }}

          - alert: HPA ƒë·ªß t√†i nguy√™n
            expr: max(
                    quantile_over_time(0.5, kube_horizontalpodautoscaler_status_desired_replicas[1d])
                    == kube_horizontalpodautoscaler_spec_min_replicas
                  ) by (horizontalpodautoscaler) > 3
            for: 0m
            labels:
              severity: info
            annotations:
              summary: "‚ÑπÔ∏è HPA s·ª≠ d·ª•ng th·∫•p ‚Äì c√≥ th·ªÉ d∆∞ t√†i nguy√™n"
              description: >
                HorizontalPodAutoscaler `{{ $labels.namespace }}/{{ $labels.horizontalpodautoscaler }}` ƒë√£ ho·∫°t ƒë·ªông ·ªü m·ª©c t·ªëi thi·ªÉu (`minReplicas`) trong **√≠t nh·∫•t 50% th·ªùi gian c·ªßa 1 ng√†y qua**.

                üëâ ƒêi·ªÅu n√†y c√≥ th·ªÉ cho th·∫•y ·ª©ng d·ª•ng ƒëang ƒë∆∞·ª£c ph√¢n b·ªï t√†i nguy√™n d∆∞ th·ª´a. C√¢n nh·∫Øc gi·∫£m s·ªë l∆∞·ª£ng replica ho·∫∑c ti·∫øt ki·ªám chi ph√≠.

                üìä Gi√° tr·ªã: {{ $value }}
                üè∑Ô∏è Nh√£n: {{ $labels }}

          - alert: POD kh√¥ng ·ªü tr·∫°ng th√°i ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng
            expr: sum by (namespace, pod, job) (kube_pod_status_phase{phase=~"Pending|Unknown|Failed"}) > 0
            for: 15m
            labels:
              severity: critical
            annotations:
              summary: "‚ùó Pod kh√¥ng ·ªü tr·∫°ng th√°i ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng"
              description: >
                Pod `{{ $labels.namespace }}/{{ $labels.pod }}` ƒë√£ ·ªü tr·∫°ng th√°i kh√¥ng ho·∫°t ƒë·ªông (Pending, Unknown ho·∫∑c Failed) li√™n t·ª•c trong h∆°n 15 ph√∫t.

                üìä Gi√° tr·ªã: {{ $value }}
                üè∑Ô∏è Nh√£n: {{ $labels }}

          - alert: HostOutOfMemory
            expr: (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) < 0.10
            for: 2m
            labels:
              severity: warning
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} s·∫Øp h·∫øt b·ªô nh·ªõ"
              description: >
                B·ªô nh·ªõ kh·∫£ d·ª•ng c·ªßa m√°y ch·ªß {{ $labels.instance }} c√≤n d∆∞·ªõi 10%. H·ªá th·ªëng c√≥ th·ªÉ g·∫∑p l·ªói do thi·∫øu RAM.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: HostMemoryUnderMemoryPressure
            expr: rate(node_vmstat_pgmajfault[5m]) > 1000
            for: 0m
            labels:
              severity: warning
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} ƒëang ch·ªãu √°p l·ª±c b·ªô nh·ªõ"
              description: >
                T·ªëc ƒë·ªô l·ªói major page fault tr√™n m√°y ch·ªß {{ $labels.instance }} cao b·∫•t th∆∞·ªùng, cho th·∫•y h·ªá th·ªëng ƒëang ph·∫£i li√™n t·ª•c n·∫°p trang b·ªô nh·ªõ t·ª´ ƒëƒ©a v√†o RAM. ƒê√¢y l√† d·∫•u hi·ªáu h·ªá th·ªëng ƒëang thi·∫øu b·ªô nh·ªõ v·∫≠t l√Ω.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}


          - alert: HostMemoryIsUnderutilized
            expr: min_over_time(node_memory_MemFree_bytes[1w]) > node_memory_MemTotal_bytes * 0.8
            for: 0m
            labels:
              severity: info
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} ƒëang s·ª≠ d·ª•ng b·ªô nh·ªõ qu√° √≠t"
              description: >
                Trong v√≤ng 1 tu·∫ßn qua, m·ª©c s·ª≠ d·ª•ng b·ªô nh·ªõ c·ªßa m√°y ch·ªß {{ $labels.instance }} lu√¥n d∆∞·ªõi 20%. B·∫°n c√≥ th·ªÉ c√¢n nh·∫Øc gi·∫£m dung l∆∞·ª£ng RAM ƒë·ªÉ t·ªëi ∆∞u chi ph√≠ ho·∫∑c t√†i nguy√™n h·ªá th·ªëng.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}


          - alert: BoNhoMayChuSuDungThap
            expr: min_over_time(node_memory_MemFree_bytes[1w]) > node_memory_MemTotal_bytes * 0.8
            for: 0m
            labels:
              severity: info
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} s·ª≠ d·ª•ng b·ªô nh·ªõ th·∫•p trong 1 tu·∫ßn"
              description: >
                Trong su·ªët 1 tu·∫ßn qua, m√°y ch·ªß {{ $labels.instance }} s·ª≠ d·ª•ng d∆∞·ªõi 20% t·ªïng dung l∆∞·ª£ng RAM. B·∫°n c√≥ th·ªÉ c√¢n nh·∫Øc gi·∫£m t√†i nguy√™n b·ªô nh·ªõ ƒë·ªÉ t·ªëi ∆∞u chi ph√≠ ho·∫∑c ph√¢n b·ªï l·∫°i cho workload kh√°c.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: LuuLuongMangVaoBatThuong
            expr: ((rate(node_network_receive_bytes_total[5m]) / on(instance, device) node_network_speed_bytes) > 0.80)
            for: 0m
            labels:
              severity: warning
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} ƒëang c√≥ l∆∞u l∆∞·ª£ng m·∫°ng v√†o cao b·∫•t th∆∞·ªùng"
              description: >
                BƒÉng th√¥ng nh·∫≠n d·ªØ li·ªáu c·ªßa m√°y ch·ªß {{ $labels.instance }} ƒëang v∆∞·ª£t qu√° 80% t·ªëc ƒë·ªô t·ªëi ƒëa c·ªßa card m·∫°ng. ƒêi·ªÅu n√†y c√≥ th·ªÉ d·∫´n ƒë·∫øn ngh·∫Ωn m·∫°ng ho·∫∑c l√†m ch·∫≠m c√°c d·ªãch v·ª• li√™n quan.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: LuuLuongMangRaBatThuong
            expr: (rate(node_network_transmit_bytes_total[5m]) / on(instance, device) node_network_speed_bytes) > 0.80
            for: 0m
            labels:
              severity: warning
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} ƒëang c√≥ l∆∞u l∆∞·ª£ng m·∫°ng ra cao b·∫•t th∆∞·ªùng"
              description: >
                BƒÉng th√¥ng truy·ªÅn d·ªØ li·ªáu t·ª´ m√°y ch·ªß {{ $labels.instance }} ƒëang v∆∞·ª£t qu√° 80% t·ªëc ƒë·ªô t·ªëi ƒëa c·ªßa card m·∫°ng. ƒêi·ªÅu n√†y c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn hi·ªáu nƒÉng c√°c d·ªãch v·ª•, g√¢y tr·ªÖ ho·∫∑c ngh·∫Ωn m·∫°ng.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: TocDoDocDiaBatThuong
            expr: rate(node_disk_io_time_seconds_total[5m]) > 0.80
            for: 0m
            labels:
              severity: warning
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} c√≥ t·ªëc ƒë·ªô ƒë·ªçc ƒëƒ©a b·∫•t th∆∞·ªùng"
              description: >
                Thi·∫øt b·ªã l∆∞u tr·ªØ tr√™n m√°y ch·ªß {{ $labels.instance }} ƒëang b·∫≠n ƒë·ªçc d·ªØ li·ªáu h∆°n 80% th·ªùi gian, c√≥ th·ªÉ g√¢y ch·∫≠m h·ªá th·ªëng ho·∫∑c tƒÉng ƒë·ªô tr·ªÖ truy xu·∫•t. H√£y ki·ªÉm tra c√°c ti·∫øn tr√¨nh I/O l·ªõn ho·∫∑c t·∫£i ƒëƒ©a ƒë·ªôt bi·∫øn.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}


          - alert: MayChuSapHetDungLuongDia
            expr: (node_filesystem_avail_bytes{fstype!~"^(fuse.*|tmpfs|cifs|nfs)"} / node_filesystem_size_bytes < 0.10 and on (instance, device, mountpoint) node_filesystem_readonly == 0)
            for: 2m
            labels:
              severity: critical
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} g·∫ßn ƒë·∫ßy dung l∆∞·ª£ng ƒëƒ©a"
              description: >
                Thi·∫øt b·ªã l∆∞u tr·ªØ t·∫°i mountpoint {{ $labels.mountpoint }} tr√™n m√°y ch·ªß {{ $labels.instance }} c√≤n d∆∞·ªõi 10% dung l∆∞·ª£ng kh·∫£ d·ª•ng. N·∫øu kh√¥ng gi·∫£i ph√≥ng ho·∫∑c m·ªü r·ªông k·ªãp th·ªùi, h·ªá th·ªëng c√≥ th·ªÉ g·∫∑p l·ªói ghi d·ªØ li·ªáu.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: MayChuSapHetInode
            expr: (node_filesystem_files_free / node_filesystem_files < 0.10 and ON (instance, device, mountpoint) node_filesystem_readonly == 0)
            for: 2m
            labels:
              severity: critical
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} s·∫Øp h·∫øt inode"
              description: >
                ·ªî ƒëƒ©a t·∫°i mountpoint {{ $labels.mountpoint }} tr√™n m√°y ch·ªß {{ $labels.instance }} s·∫Øp h·∫øt inode kh·∫£ d·ª•ng (c√≤n d∆∞·ªõi 10%). ƒêi·ªÅu n√†y c√≥ th·ªÉ khi·∫øn h·ªá th·ªëng kh√¥ng th·ªÉ t·∫°o th√™m file d√π v·∫´n c√≤n dung l∆∞·ª£ng ƒëƒ©a tr·ªëng.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: LoiHeThongTepTrenMayChu
            expr: node_filesystem_device_error{fstype!~"^(fuse.*|tmpfs|cifs|nfs)"} == 1
            for: 2m
            labels:
              severity: critical
            annotations:
              summary: "L·ªói h·ªá th·ªëng t·ªáp t·∫°i {{ $labels.mountpoint }} tr√™n m√°y ch·ªß {{ $labels.instance }}"
              description: >
                M√°y ch·ªß {{ $labels.instance }} g·∫∑p l·ªói khi truy xu·∫•t h·ªá th·ªëng t·ªáp t·∫°i mountpoint {{ $labels.mountpoint }}. ƒêi·ªÅu n√†y c√≥ th·ªÉ do l·ªói thi·∫øt b·ªã l∆∞u tr·ªØ, h·ªèng ·ªï ƒëƒ©a, ho·∫∑c m·∫•t k·∫øt n·ªëi. C·∫ßn ki·ªÉm tra ngay ƒë·ªÉ tr√°nh m·∫•t d·ªØ li·ªáu.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: DuBaoHetInodeTrong24Gio
            expr: predict_linear(node_filesystem_files_free{fstype!~"^(fuse.*|tmpfs|cifs|nfs)"}[1h], 86400) <= 0 and node_filesystem_files_free > 0
            for: 2m
            labels:
              severity: warning
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} c√≥ nguy c∆° h·∫øt inode trong 24 gi·ªù"
              description: >
                H·ªá th·ªëng d·ª± ƒëo√°n mountpoint {{ $labels.mountpoint }} tr√™n m√°y ch·ªß {{ $labels.instance }} s·∫Ω h·∫øt inode trong v√≤ng 24 gi·ªù n·∫øu t·ªëc ƒë·ªô ghi hi·ªán t·∫°i ti·∫øp t·ª•c duy tr√¨. Vui l√≤ng ki·ªÉm tra v√† x·ª≠ l√Ω s·ªõm ƒë·ªÉ tr√°nh gi√°n ƒëo·∫°n d·ªãch v·ª•.
                ‚ñ∏ Gi√° tr·ªã d·ª± ƒëo√°n: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: DoTreDocDiaBatThuong
            expr: (rate(node_disk_read_time_seconds_total[1m]) / rate(node_disk_reads_completed_total[1m]) > 0.1 and rate(node_disk_reads_completed_total[1m]) > 0)
            for: 2m
            labels:
              severity: warning
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} c√≥ ƒë·ªô tr·ªÖ ƒë·ªçc ƒëƒ©a b·∫•t th∆∞·ªùng"
              description: >
                ƒê·ªô tr·ªÖ trung b√¨nh c·ªßa c√°c thao t√°c ƒë·ªçc tr√™n thi·∫øt b·ªã l∆∞u tr·ªØ c·ªßa m√°y ch·ªß {{ $labels.instance }} ƒëang v∆∞·ª£t qu√° 100ms. ƒê√¢y c√≥ th·ªÉ l√† d·∫•u hi·ªáu c·ªßa ·ªï ƒëƒ©a s·∫Øp h·ªèng ho·∫∑c b·ªã qu√° t·∫£i I/O.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: DoTreGhiDiaBatThuong
            expr: (rate(node_disk_write_time_seconds_total[1m]) / rate(node_disk_writes_completed_total[1m]) > 0.1 and rate(node_disk_writes_completed_total[1m]) > 0)
            for: 2m
            labels:
              severity: warning
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} c√≥ ƒë·ªô tr·ªÖ ghi ƒëƒ©a b·∫•t th∆∞·ªùng"
              description: >
                ƒê·ªô tr·ªÖ trung b√¨nh c·ªßa c√°c thao t√°c ghi d·ªØ li·ªáu tr√™n thi·∫øt b·ªã l∆∞u tr·ªØ c·ªßa m√°y ch·ªß {{ $labels.instance }} ƒëang v∆∞·ª£t qu√° 100ms. ƒê√¢y c√≥ th·ªÉ l√† d·∫•u hi·ªáu ·ªï ƒëƒ©a ƒëang b·ªã qu√° t·∫£i, c√≥ l·ªói ph·∫ßn c·ª©ng ho·∫∑c I/O bottleneck.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: TaiCPUTrenMayChuCao
            expr: avg by (instance) (rate(node_cpu_seconds_total{mode!="idle"}[2m])) > 0.80
            for: 10m
            labels:
              severity: warning
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} ƒëang c√≥ m·ª©c s·ª≠ d·ª•ng CPU cao"
              description: >
                T·∫£i CPU c·ªßa m√°y ch·ªß {{ $labels.instance }} ƒë√£ v∆∞·ª£t qu√° 80% trong v√≤ng 10 ph√∫t li√™n t·ª•c. ƒêi·ªÅu n√†y c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn hi·ªáu su·∫•t x·ª≠ l√Ω c·ªßa h·ªá th·ªëng ho·∫∑c g√¢y tr·ªÖ cho c√°c ·ª©ng d·ª•ng ƒëang ch·∫°y.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          # - alert: TaiNguyenCpuSuDungThap
          #   expr: (min by (instance) (rate(node_cpu_seconds_total{mode="idle"}[1h]))) > 0.8
          #   for: 1w
          #   labels:
          #     severity: info
          #   annotations:
          #     summary: "M√°y ch·ªß {{ $labels.instance }} s·ª≠ d·ª•ng CPU qu√° th·∫•p trong 1 tu·∫ßn"
          #     description: >
          #       CPU c·ªßa m√°y ch·ªß {{ $labels.instance }} ho·∫°t ƒë·ªông d∆∞·ªõi 20% trong su·ªët 1 tu·∫ßn qua. B·∫°n c√≥ th·ªÉ c√¢n nh·∫Øc gi·∫£m s·ªë l∆∞·ª£ng CPU ho·∫∑c ph√¢n b·ªï t√†i nguy√™n hi·ªáu qu·∫£ h∆°n.
          #       ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
          #       ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: VMBiAnhHuongBoiNoisyNeighbor
            expr: avg by(instance) (rate(node_cpu_seconds_total{mode="steal"}[5m])) * 100 > 10
            for: 0m
            labels:
              severity: warning
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} b·ªã ·∫£nh h∆∞·ªüng b·ªüi CPU steal cao"
              description: >
                M·ª©c CPU steal tr√™n m√°y ch·ªß {{ $labels.instance }} ƒëang v∆∞·ª£t qu√° 10%. ƒêi·ªÅu n√†y cho th·∫•y c√≥ th·ªÉ ƒëang b·ªã ·∫£nh h∆∞·ªüng b·ªüi noisy neighbor trong m√¥i tr∆∞·ªùng ·∫£o h√≥a, ho·∫∑c phi√™n b·∫£n spot ƒë√£ h·∫øt credit CPU d·∫´n ƒë·∫øn hi·ªáu nƒÉng th·∫•p.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}%
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: CpuIowaitCao
            expr: avg by (instance) (rate(node_cpu_seconds_total{mode="iowait"}[5m])) > 0.10
            for: 0m
            labels:
              severity: warning
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} c√≥ m·ª©c iowait CPU cao"
              description: >
                M·ª©c iowait tr√™n CPU c·ªßa m√°y ch·ªß {{ $labels.instance }} ƒëang v∆∞·ª£t qu√° 10%. ƒêi·ªÅu n√†y cho th·∫•y CPU ƒëang b·ªã ch·∫∑n v√¨ ph·∫£i ch·ªù ph·∫£n h·ªìi t·ª´ thi·∫øt b·ªã l∆∞u tr·ªØ (ƒëƒ©a, SSD...), c√≥ th·ªÉ do I/O ch·∫≠m ho·∫∑c qu√° t·∫£i.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: HoatDongIOCuaDiaBatThuong
            expr: rate(node_disk_io_time_seconds_total[5m]) > 0.8
            for: 5m
            labels:
              severity: warning
            annotations:
              summary: "Thi·∫øt b·ªã l∆∞u tr·ªØ tr√™n m√°y ch·ªß {{ $labels.instance }} ƒëang ho·∫°t ƒë·ªông qu√° m·ª©c"
              description: >
                Thi·∫øt b·ªã l∆∞u tr·ªØ tr√™n m√°y ch·ªß {{ $labels.instance }} ƒëang ho·∫°t ƒë·ªông h∆°n 80% th·ªùi gian trong 5 ph√∫t g·∫ßn nh·∫•t. ƒêi·ªÅu n√†y c√≥ th·ªÉ g√¢y ra ƒë·ªô tr·ªÖ I/O ho·∫∑c ·∫£nh h∆∞·ªüng ƒë·∫øn hi·ªáu su·∫•t h·ªá th·ªëng. Vui l√≤ng ki·ªÉm tra t√¨nh tr·∫°ng l∆∞u tr·ªØ, m·ªü r·ªông IOPS n·∫øu c·∫ßn.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: LuotChuyenNguCanhTangDotBien
            expr: (rate(node_context_switches_total[15m]) / count without(mode, cpu) (node_cpu_seconds_total{mode="idle"}))
                  /
                  (rate(node_context_switches_total[1d]) / count without(mode, cpu) (node_cpu_seconds_total{mode="idle"})) > 2
            for: 0m
            labels:
              severity: warning
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} c√≥ s·ªë l·∫ßn chuy·ªÉn ng·ªØ c·∫£nh tƒÉng cao b·∫•t th∆∞·ªùng"
              description: >
                S·ªë l·∫ßn chuy·ªÉn ng·ªØ c·∫£nh (context switching) tr√™n m√°y ch·ªß {{ $labels.instance }} trong 15 ph√∫t g·∫ßn nh·∫•t ƒëang cao g·∫•p ƒë√¥i trung b√¨nh 1 ng√†y. ƒêi·ªÅu n√†y c√≥ th·ªÉ l√† d·∫•u hi·ªáu cho th·∫•y h·ªá th·ªëng ƒëang x·ª≠ l√Ω qu√° nhi·ªÅu ti·∫øn tr√¨nh nh·ªè ho·∫∑c c√≥ v·∫•n ƒë·ªÅ v·ªÅ l·ªãch tr√¨nh CPU.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: VungSwapDangDay
            expr: ((1 - (node_memory_SwapFree_bytes / node_memory_SwapTotal_bytes)) * 100 > 80)
            for: 2m
            labels:
              severity: warning
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} ƒëang s·ª≠ d·ª•ng swap v∆∞·ª£t qu√° 80%"
              description: >
                V√πng swap tr√™n m√°y ch·ªß {{ $labels.instance }} ƒëang ƒë∆∞·ª£c s·ª≠ d·ª•ng v∆∞·ª£t qu√° 80%. Vi·ªác s·ª≠ d·ª•ng swap cao c√≥ th·ªÉ l√†m h·ªá th·ªëng ch·∫≠m l·∫°i ƒë√°ng k·ªÉ v√† l√† d·∫•u hi·ªáu cho th·∫•y b·ªô nh·ªõ v·∫≠t l√Ω (RAM) ƒëang thi·∫øu h·ª•t.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}%
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: DichVuSystemdBiLoi
            expr: node_systemd_unit_state{state="failed"} == 1
            for: 0m
            labels:
              severity: warning
            annotations:
              summary: "M·ªôt d·ªãch v·ª• systemd tr√™n m√°y ch·ªß {{ $labels.instance }} ƒë√£ b·ªã l·ªói"
              description: >
                Ph√°t hi·ªán m·ªôt d·ªãch v·ª• systemd ƒëang ·ªü tr·∫°ng th√°i `failed` tr√™n m√°y ch·ªß {{ $labels.instance }}. Vui l√≤ng ki·ªÉm tra ngay ƒë·ªÉ kh√¥i ph·ª•c d·ªãch v·ª• n·∫øu c·∫ßn thi·∫øt.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: ThayDoiPhienBanKernel
            expr: changes(node_uname_info[1h]) > 0
            for: 0m
            labels:
              severity: info
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} c√≥ s·ª± thay ƒë·ªïi phi√™n b·∫£n kernel"
              description: >
                M√°y ch·ªß {{ $labels.instance }} ƒë√£ thay ƒë·ªïi phi√™n b·∫£n kernel trong v√≤ng 1 gi·ªù qua. ƒêi·ªÅu n√†y c√≥ th·ªÉ do c·∫≠p nh·∫≠t h·ªá th·ªëng, kh·ªüi ƒë·ªông l·∫°i, ho·∫∑c s·ª± c·ªë kh·∫©n c·∫•p.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: PhatHienTienTrinhBiOomKill
            expr: increase(node_vmstat_oom_kill[1m]) > 0
            for: 0m
            labels:
              severity: warning
            annotations:
              summary: "Ph√°t hi·ªán OOM Kill tr√™n m√°y ch·ªß {{ $labels.instance }}"
              description: >
                H·ªá th·ªëng ƒë√£ ghi nh·∫≠n m·ªôt ho·∫∑c nhi·ªÅu ti·∫øn tr√¨nh b·ªã k·∫øt th√∫c do thi·∫øu b·ªô nh·ªõ (OOM Kill) tr√™n m√°y ch·ªß {{ $labels.instance }}. C·∫ßn ki·ªÉm tra nguy√™n nh√¢n (·ª©ng d·ª•ng chi·∫øm RAM cao, thi·∫øu swap, c·∫•u h√¨nh gi·ªõi h·∫°n b·ªô nh·ªõ...).
                ‚ñ∏ S·ªë l∆∞·ª£ng OOM kill m·ªõi: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: LoiNhanGoiTinMang
            expr: rate(node_network_receive_errs_total[2m]) / rate(node_network_receive_packets_total[2m]) > 0.01
            for: 2m
            labels:
              severity: warning
            annotations:
              summary: "Giao di·ªán m·∫°ng c·ªßa m√°y ch·ªß {{ $labels.instance }} g·∫∑p l·ªói khi nh·∫≠n g√≥i tin"
              description: >
                Trong 2 ph√∫t g·∫ßn ƒë√¢y, giao di·ªán m·∫°ng {{ $labels.device }} tr√™n m√°y ch·ªß {{ $labels.instance }} ƒë√£ g·∫∑p l·ªói nh·∫≠n g√≥i tin v·ªõi t·ª∑ l·ªá v∆∞·ª£t 1%. ƒêi·ªÅu n√†y c√≥ th·ªÉ g√¢y m·∫•t k·∫øt n·ªëi ho·∫∑c suy gi·∫£m hi·ªáu nƒÉng truy·ªÅn t·∫£i.
                ‚ñ∏ T·ªïng l·ªói nh·∫≠n: {{ printf "%.0f" $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: GiaoDienBondMangBiSuyGiam
            expr: (node_bonding_active - node_bonding_slaves) != 0
            for: 2m
            labels:
              severity: warning
            annotations:
              summary: "Giao di·ªán bonding tr√™n m√°y ch·ªß {{ $labels.instance }} b·ªã suy gi·∫£m"
              description: >
                Giao di·ªán bonding "{{ $labels.device }}" tr√™n m√°y ch·ªß {{ $labels.instance }} kh√¥ng c√≤n ƒë·ªß s·ªë l∆∞·ª£ng interface th√†nh ph·∫ßn (slave) ho·∫°t ƒë·ªông. ƒêi·ªÅu n√†y l√†m gi·∫£m t√≠nh d·ª± ph√≤ng v√† hi·ªáu nƒÉng m·∫°ng.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }}
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: DongBoThoiGianKhongHoatDong
            expr: (min_over_time(node_timex_sync_status[1m]) == 0 and node_timex_maxerror_seconds >= 16)
            for: 2m
            labels:
              severity: warning
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} kh√¥ng ƒë·ªìng b·ªô th·ªùi gian"
              description: >
                ƒê·ªìng h·ªì h·ªá th·ªëng tr√™n m√°y ch·ªß {{ $labels.instance }} kh√¥ng ƒë∆∞·ª£c ƒë·ªìng b·ªô v·ªõi NTP v√† ƒë·ªô l·ªách th·ªùi gian ƒë√£ v∆∞·ª£t qu√° ng∆∞·ª°ng cho ph√©p (>= 16 gi√¢y). Vui l√≤ng ki·ªÉm tra c·∫•u h√¨nh v√† tr·∫°ng th√°i d·ªãch v·ª• NTP/chrony.
                ‚ñ∏ Gi√° tr·ªã hi·ªán t·∫°i: {{ $value }} gi√¢y
                ‚ñ∏ Th√¥ng tin nh√£n: {{ $labels }}

          - alert: STATUS SERVER
            expr: up{job='kubernetes-nodes'} == 0
            for: 2m
            labels:
              severity: critical
            annotations:
              summary: "M√°y ch·ªß {{ $labels.instance }} b·ªã t·∫Øt"
              description: "H·ªá th·ªëng ph√°t hi·ªán m√°y ch·ªß {{ $labels.instance }} ƒë√£ ng·ª´ng ph·∫£n h·ªìi trong h∆°n 2 ph√∫t. Vui l√≤ng ki·ªÉm tra t√¨nh tr·∫°ng k·∫øt n·ªëi ho·∫∑c d·ªãch v·ª•."

persistence:
  enabled: false
  # storageClass: "-"
  # size: 8Gi